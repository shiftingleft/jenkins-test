pipeline {
    agent any
    stage('Build/Pull') {
        sh "rm -f ${env.WORKSPACE}/*.tar"
        sh 'docker pull webgoat/webgoat-7.1'
        sh "docker save webgoat/webgoat-7.1 -o ${env.WORKSPACE}/webgoat-7.1.tar"
    }
    stage('IQ Evaluation') {
        nexusPolicyEvaluation (
            failBuildOnNetworkError: false, 
            iqApplication: 'dockerapp',
            iqScanPatterns: [[scanPattern: '*.tar']],
            iqStage: 'release',
            jobCredentialsId: ''
        )
    }
}
